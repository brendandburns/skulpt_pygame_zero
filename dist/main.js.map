{"version":3,"sources":["utils.ts","main.ts"],"names":[],"mappings":"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","file":"main.js","sourceRoot":"../src","sourcesContent":["export function loadScript(src: string, varName: string){\n  if (window[varName]) {\n    return Promise.resolve(window[varName]);\n  }\n  const res = new Promise(function(resolve, reject) {\n    const el = document.createElement('script');\n    el.onload = function() {\n      resolve(varName && window.varName);\n    };\n\n    el.onerror = function(e) {\n      el.onload = null;\n      el.onerror = null;\n      document.body.removeChild(el);\n      reject(e);\n    };\n    el.src = src;\n    el.async = true;\n    document.body.appendChild(el);\n  });\n  return res;\n}\n\n// 运行前销毁\nexport const resetPygameZero = function(ModuleCache) {\n  if (ModuleCache.App) {\n    // document.getElementById('stage').removeChild(ModuleCache.App.view);\n    ModuleCache.App.destroy({\n      removeView: true\n    });\n    window.PIXI.loader.destroy();\n    ModuleCache.App = void 0;\n    for (let [key,value] of ModuleCache.timerMap) {\n      window.clearInterval(value)\n      window.clearTimeout(value)\n    }\n    ModuleCache.timerMap.clear();\n    ModuleCache.soundMap = {};\n    ModuleCache.music.pause();\n    ModuleCache.music = null;\n    ModuleCache.music = new Audio();\n    Object.keys(ModuleCache.windowListener).map((key) => {\n      const eventName = key.replace('Listener', '');\n      window.removeEventListener(eventName, ModuleCache.windowListener[key])\n    })\n  }\n}\n\n// 17中标准颜色名对应的色值\nexport const ColorNameMap = {\n  aqua: '#00FFFF',\n  black: '#000000',\n  blue: '#0000FF',\n  fuchsia: '#FF00FF',\n  gray: '#808080',\n  green: '#008000',\n  lime: '#00FF00',\n  maroon: '#800000',\n  navy: '#000080',\n  olive: '#808000',\n  orange: '#FFA500',\n  purple: '#800080',\n  red: '#FF0000',\n  silver: '#C0C0C0',\n  teal: '#008080',\n  white: '#FFFFFF',\n  yellow: '#FFFF00',\n}\n\nexport const translateTools = function(app) {\n  const halfWidth = Math.round(app.view.width/2);\n  const halfHeight = Math.round(app.view.height/2);\n  const tools = {\n    // 笛卡尔坐标系转换\n    transX(x, isReserve = false) {\n      // if (isReserve) {\n      //   return x - halfWidth\n      // } else {\n      //   return x + halfWidth\n      // }\n      return x;\n    },\n    transY(y, isReserve = false) {\n      // if (isReserve) {\n      //   if (y > halfHeight) {\n      //     return (y - halfHeight) * -1;\n      //   } else {\n      //     return halfHeight - y;\n      //   }\n      // } else {\n      //   if (y > 0) {\n      //     return halfHeight - y;\n      //   } else {\n      //     return halfHeight + (y * -1);\n      //   }\n      // }\n      return y;\n    },\n    transPos(pos, isReserve = false){\n      if (!pos) {\n        return pos\n      }\n      return [tools.transX(pos[0], isReserve), tools.transY(pos[1], isReserve)]\n    },\n    // 字符串色值转十六进制数字\n    transColor(color) {\n      if (Array.isArray(color)) {\n        return window.PIXI.utils.rgb2hex(color);\n      } else {\n        if (color.match('#')) {\n          return window.PIXI.utils.string2hex(color);\n        } else {\n          if (ColorNameMap[color]) {\n            return window.PIXI.utils.string2hex(ColorNameMap[color]);\n          } else {\n            return 0xffffff;\n          }\n        }\n      }\n    }\n  }\n  return tools;\n}\n\n// 碰撞检测函数\nexport function hitTestRectangle(r1, r2) {\n  // 如果r2是坐标点\n  if (Array.isArray(r2)) {\n    r2.x = r2[0];\n    r2.y = r2[1];\n    r2.width = 0;\n    r2.height = 0;\n  }\n\n  //Define the variables we'll need to calculate\n  let hit;\n\n  //hit will determine whether there's a collision\n  hit = false;\n\n  //Find the center points of each sprite\n  r1.centerX = r1.x + r1.width / 2;\n  r1.centerY = r1.y + r1.height / 2;\n  r2.centerX = r2.x + r2.width / 2;\n  r2.centerY = r2.y + r2.height / 2;\n\n  //Find the half-widths and half-heights of each sprite\n  r1.halfWidth = r1.width / 2;\n  r1.halfHeight = r1.height / 2;\n  r2.halfWidth = r2.width / 2;\n  r2.halfHeight = r2.height / 2;\n\n  //Calculate the distance vector between the sprites\n  const vx = r1.centerX - r2.centerX;\n  const vy = r1.centerY - r2.centerY;\n\n  //Figure out the combined half-widths and half-heights\n  const combinedHalfWidths = r1.halfWidth + r2.halfWidth;\n  const combinedHalfHeights = r1.halfHeight + r2.halfHeight;\n\n  //Check for a collision on the x axis\n  if (Math.abs(vx) < combinedHalfWidths) {\n\n    //A collision might be occuring. Check for a collision on the y axis\n    if (Math.abs(vy) < combinedHalfHeights) {\n\n      //There's definitely a collision happening\n      hit = true;\n    } else {\n\n      //There's no collision on the y axis\n      hit = false;\n    }\n  } else {\n\n    //There's no collision on the x axis\n    hit = false;\n  }\n\n  //`hit` will be either `true` or `false`\n  return hit;\n}\n\n// 加载纹理\nconst JsonLoadedMap = {};\nexport function textureRecources (resource) {\n  function loadResource(resource) {\n    let list;\n    if (Array.isArray(resource)) {\n      list = [...resource];\n      resource = list[0]\n    }\n    return new Promise((resolve, reject) => {\n      if (window.PIXI.utils.TextureCache[resource]) {\n        resolve(window.PIXI.utils.TextureCache[resource])\n      } else {\n        window.PIXI.loader.add(list || resource).load(function() {\n          const texture = window.PIXI.loader.resources[resource].texture;\n          resolve(texture)\n        });\n      }\n    })\n  }\n  if (/\\.json$/.test(resource)) {\n    if (JsonLoadedMap[resource]) {\n      return loadResource(JsonLoadedMap[resource])\n    } else {\n      return fetch(resource).then((res) => {\n        return res.json()\n      }).then((res) => {\n        const prefix = resource.replace('index.json', '');\n        const resoureList = res.map((item) => {\n          return prefix + item\n        })\n        JsonLoadedMap[resource] = resoureList;\n        return loadResource(resoureList)\n      })\n    }\n  } else {\n    return loadResource(resource)\n  }\n}\nconst Sk = window.Sk;\n// getter函数\nexport const defineGetter = function(func) {\n  return Sk.misceval.callsimOrSuspend(Sk.builtins.property, new Sk.builtin.func(func), new Sk.builtin.func(function() {}));\n}\n// 生成kwargs函数\nexport function genkwaFunc(func, isJsArgs) {\n  const kwaFunc = function(kwa, ...args){\n    if (!isJsArgs) {\n      args = new Sk.builtins['tuple'](args); /*vararg*/\n    }\n    const kwargs = new Sk.builtin.dict(kwa);\n    return func(args, kwargs)\n  }\n  kwaFunc['co_kwargs'] = true;\n  return kwaFunc;\n}\n// 监听属性getter/setter\nexport const defineProperty = function(obj, property) {\n  return Sk.misceval.callsimOrSuspend(Sk.builtins.property, new Sk.builtin.func(function(self) {\n    if (typeof obj === 'function') {\n      return obj(self)\n    } else {\n      return Sk.ffi.remapToPy(self[obj][property])\n    }\n  }), new Sk.builtin.func(function(self, val) {\n    if (typeof property === 'function') {\n      property(self, val)\n    } else {\n      self[obj][property] = val.v;\n    }\n  }))\n}\n  \n\n","import {loadScript} from './utils'\nconst Sk = window.Sk;\nconst libList = {\n  \"./pgzrun/__init__.js\": \"./dist/pygame-zero.js\",\n  // \"./pgzrun/__init__.js\": \"https://cdn.jsdelivr.net/gh/lipten/skulpt-pygame-zero/dist/pygame-zero.js\",\n}\nexport const PyGameZero = {\n  usePyGameZero: function(readFn) {\n    const _this = this;\n    return function(file) {\n      if (_this.matchModelName(file)) {\n        return _this.load(file)\n      } else {\n        return readFn.call(this, file)\n      }\n    }\n  },\n  load: function(file) {\n    return Sk.misceval.promiseToSuspension(\n      new Promise((resolve, reject) => {\n        loadScript('https://cdn.bootcdn.net/ajax/libs/pixi.js/5.3.4/pixi.min.js', 'PIXI').then(() => {\n          fetch(libList[file]).then(\n            function (resp){ \n              const result = resp.text();\n              resolve(result); \n            }\n          )\n        })\n      }))\n  },\n  matchModelName: function(file) {\n    return Object.keys(libList).includes(file);\n  },\n  setContainer: function(el) {\n    this.container = el;\n  },\n  reset: function() { \n    this._handleReset();\n  },\n  _handleReset: function() {\n  },\n  _onRunning: function(app) {\n    this.app = app;\n  },\n  _moduleCache: {\n    App: null,\n    timerMap: new Map(),\n    soundMap: {},\n    music: new Audio(),\n    windowListener: {}\n  }\n}\nwindow.PyGameZero = PyGameZero"]}